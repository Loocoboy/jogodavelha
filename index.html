<!DOCTYPE html>
<html lang="pt-BR">

<head>
  <meta charset="UTF-8">
  <title>Jogo da Velha</title>
  <style>
    /* Estilo geral do corpo da p√°gina */
    body {
      font-family: 'Arial', sans-serif;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      margin: 0;
      background-color: #EDDDC4;
      color: #283D3B;
      position: relative;
    }

    /* Estilo do menu inicial */
    .menu-container {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(237, 221, 196, 0.95);
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      z-index: 1000;
    }

    /* Estilo do t√≠tulo do menu */
    .menu-container h1 {
      font-size: 48px;
      color: #197278;
      margin-bottom: 20px;
    }

    /* Estilo dos bot√µes do menu */
    .menu-container button {
      margin: 10px;
      padding: 12px 24px;
      font-size: 18px;
      border: none;
      border-radius: 10px;
      background-color: #197278;
      color: white;
      cursor: pointer;
      transition: transform 0.2s ease;
    }

    /* Efeito de aumento do bot√£o ao passar o mouse */
    .menu-container button:hover {
      transform: scale(1.05);
    }

    /* Estilo do campo de inser√ß√£o de nickname */
    .nickname-input {
      display: none;
      flex-direction: column;
      align-items: center;
      gap: 10px;
      margin-top: 20px;
    }

    /* Estilo do campo de texto para digitar o nickname */
    .nickname-input input {
      padding: 10px;
      font-size: 16px;
      border-radius: 8px;
      border: 1px solid #ccc;
    }

    /* Estilo do bot√£o para iniciar o jogo */
    .nickname-input button {
      padding: 10px 20px;
      font-size: 16px;
      background-color: #C44536;
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
    }

    /* Estilo da barra superior com nome do jogador */
    .top-bar {
      display: flex;
      justify-content: center;
      align-items: center;
      position: absolute;
      top: 20px;
      left: 20px;
      right: 20px;
      padding: 0 20px;
      background-color: #197278;
      color: white;
      font-size: 22px;
      font-weight: bold;
      border-radius: 10px;
      z-index: 2;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
    }

    /* Estilo do nome do jogador exibido na barra superior */
    .top-bar .player-name {
      margin: 0;
      font-size: 24px;
      color: #f7f6ef;
      text-shadow: 2px 2px 5px rgba(0, 0, 0, 0.3);
    }

    /* Estilo do tabuleiro do jogo */
    .board {
      display: grid;
      grid-template-columns: repeat(3, 120px);
      gap: 10px;
      background-color: #283D3B;
      border-radius: 15px;
      box-shadow: 0 10px 30px #00000033;
      margin-top: 130px;
      padding: 20px;
    }

    /* Estilo das c√©lulas do tabuleiro */
    .cell {
      width: 120px;
      height: 120px;
      font-size: 48px;
      background-color: #EDD4C4;
      display: flex;
      justify-content: center;
      align-items: center;
      cursor: pointer;
      user-select: none;
      transition: transform 0.3s ease, background-color 0.3s ease;
      border: 2px solid #C44536;
      border-radius: 10px;
    }

    /* Efeito de hover nas c√©lulas */
    .cell:hover {
      background-color: #C44536;
      transform: scale(1.05);
    }

    /* Estilo da √°rea de status do jogo */
    .status {
      margin-top: 20px;
      font-size: 18px;
      color: #283D3B;
    }

    /* Estilo da mensagem de vit√≥ria */
    .victory-message {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: 50px;
      color: #C44536;
      font-weight: bold;
      display: none;
      animation: showMessage 1s forwards;
    }

    /* Anima√ß√£o para a mensagem de vit√≥ria aparecer */
    @keyframes showMessage {
      0% {
        opacity: 0;
        transform: translate(-50%, -50%) scale(0.5);
      }
      100% {
        opacity: 1;
        transform: translate(-50%, -50%) scale(1);
      }
    }

    /* Anima√ß√£o de fade-out para a remo√ß√£o das c√©lulas */
    @keyframes fadeOut {
      0% {
        opacity: 1;
      }
      100% {
        opacity: 0;
      }
    }

    /* Estilo do bot√£o de reiniciar o jogo */
    .restart-btn {
      position: absolute;
      top: 220px;
      left: 50%;
      transform: translateX(-50%);
      padding: 12px 28px;
      font-size: 18px;
      font-weight: bold;
      background-color: #197278;
      color: #FFFFFF;
      border: none;
      border-radius: 12px;
      cursor: pointer;
      box-shadow: 0 6px 12px rgba(0, 0, 0, 0.25);
      transition: all 0.3s ease;
      z-index: 10;
      display: none;
    }

    /* Efeito de hover no bot√£o de reiniciar */
    .restart-btn:hover {
      background-color: #145A5C;
      transform: translateX(-50%) scale(1.05);
    }
  </style>
</head>

<body>
  <!-- Menu de in√≠cio do jogo -->
  <div class="menu-container" id="menu">
    <h1>Jogo da Velha Infinito</h1>
    <button onclick="mostrarNickname()">Jogar</button>
    <button onclick="alert('Jogo da Velha com regras infinitas! Remo√ß√£o de jogadas antigas quando n√£o h√° vencedor.')">Como Jogar</button>
    <button onclick="alert('Desenvolvido por Voc√™')">Cr√©ditos</button>
    <div class="nickname-input" id="nicknameInput">
      <input type="text" id="playerName" placeholder="Digite seu nome" />
      <button onclick="startGame()">Iniciar Jogo</button>
    </div>
  </div>

  <!-- Barra superior com nome do jogador -->
  <div class="top-bar" style="display: none;">
    <p class="player-name" id="playerNameDisplay">Jogador: </p>
  </div>

  <!-- Bot√£o de reiniciar o jogo -->
  <button id="restartButton" class="restart-btn" onclick="resetGame()">
    üîÑ Reiniciar Jogo
  </button>

  <!-- Tabuleiro do jogo -->
  <div class="board" id="board"></div>
  <div class="status" id="status">Sua vez (X)</div>
  <div id="victoryMessage" class="victory-message">Vit√≥ria!</div>

  <script>
    /* Fun√ß√£o que exibe o campo para inserir o nickname */
    function mostrarNickname() {
      document.getElementById("nicknameInput").style.display = "flex";
    }

    const board = document.getElementById("board");  // Refer√™ncia ao tabuleiro
    const status = document.getElementById("status");  // Refer√™ncia ao status do jogo
    const victoryMessage = document.getElementById("victoryMessage");  // Mensagem de vit√≥ria
    const playerNameInput = document.getElementById("playerName");  // Campo de texto para o nickname
    const playerNameDisplay = document.getElementById("playerNameDisplay");  // Exibi√ß√£o do nome do jogador
    const restartButton = document.getElementById("restartButton");  // Bot√£o de reiniciar
    const menu = document.getElementById("menu");  // Menu de in√≠cio do jogo

    /* Vari√°veis de controle do jogo */
    let cells = Array(9).fill(null);  // Estado das c√©lulas (vazio ou X/O)
    let currentPlayer = 'X';  // Jogador atual (X ou O)
    let gameOver = false;  // Indica se o jogo acabou
    let moveHistory = [];  // Hist√≥rico das jogadas
    let removeIndex = 0;  // √çndice para remo√ß√£o das jogadas antigas
    let inRemovalMode = false;  // Flag para saber se est√° no modo de remo√ß√£o
    let playerName = '';  // Nome do jogador
    let botName = 'Bot Infinito';  // Nome do bot (personaliz√°vel)

    /* Padr√µes de vit√≥ria no jogo */
    const winPatterns = [
      [0, 1, 2], [3, 4, 5], [6, 7, 8],
      [0, 3, 6], [1, 4, 7], [2, 5, 8],
      [0, 4, 8], [2, 4, 6]
    ];

    /* Fun√ß√£o para renderizar o tabuleiro */
    function renderBoard() {
      board.innerHTML = "";  // Limpa o conte√∫do do tabuleiro
      cells.forEach((cell, i) => {
        const div = document.createElement("div");  // Cria uma nova c√©lula
        div.classList.add("cell");  // Aplica a classe de estilo
        div.textContent = cell;  // Exibe X ou O
        div.addEventListener("click", () => handleClick(i));  // Adiciona evento de clique
        board.appendChild(div);  // Adiciona a c√©lula ao tabuleiro
      });
    }

    /* Fun√ß√£o que inicia o jogo */
    function startGame() {
      playerName = playerNameInput.value || 'Jogador';  // Define o nome do jogador
      playerNameDisplay.textContent = `Jogador: ${playerName}`;  // Exibe o nome na barra superior
      document.querySelector(".top-bar").style.display = 'flex';  // Exibe a barra superior
      menu.style.display = 'none';  // Esconde o menu
      renderBoard();  // Renderiza o tabuleiro
    }

    /* Fun√ß√£o que lida com os cliques nas c√©lulas */
    function handleClick(index) {
      if (cells[index] || gameOver || currentPlayer !== 'X') return;  // Verifica se a c√©lula est√° ocupada ou se o jogo acabou
      playTurn(index, 'X');  // Realiza a jogada
    }

    /* Fun√ß√£o que realiza uma jogada */
    function playTurn(index, player) {
      if (cells[index] !== null) return;  // Verifica se a c√©lula est√° vazia

      cells[index] = player;  // Marca a c√©lula com o jogador (X ou O)
      moveHistory.push({ index, player });  // Adiciona a jogada ao hist√≥rico
      renderBoard();  // Atualiza o tabuleiro

      const cell = board.children[index];
      cell.classList.add('filled');  // Adiciona a classe "filled" √† c√©lula

      if (checkWin(player)) {  // Verifica se o jogador venceu
        status.textContent = `${player === 'X' ? playerName : botName} venceu!`;  // Exibe mensagem de vit√≥ria
        gameOver = true;  // Marca o fim do jogo
        showVictoryAnimation();  // Exibe anima√ß√£o de vit√≥ria
        return;
      }

      const emptyCount = cells.filter(c => c === null).length;  // Conta as c√©lulas vazias
      if (!inRemovalMode && (emptyCount === 0 || emptyCount <= 2)) {
        inRemovalMode = true;
        removeIndex = 0;
        status.textContent = "Continuando o jogo... removendo jogadas antigas";  // Inicia a remo√ß√£o de jogadas antigas
      }

      currentPlayer = player === 'X' ? 'O' : 'X';  // Alterna o jogador
      status.textContent = currentPlayer === 'X' ? `Sua vez (${playerName})` : `Vez do Bot (${botName})`;  // Atualiza o status

      if (inRemovalMode && removeIndex < moveHistory.length) {
        setTimeout(() => {
          removeOldestMove();  // Remove a jogada mais antiga
          renderBoard();  // Atualiza o tabuleiro
        }, 300);
      }

      if (!gameOver && currentPlayer === 'O') {  // Se o bot est√° jogando
        setTimeout(botMove, 600);  // Realiza a jogada do bot
      }
    }

    /* Fun√ß√£o para remover a jogada mais antiga */
    function removeOldestMove() {
      if (removeIndex >= moveHistory.length) return;
      const move = moveHistory[removeIndex];
      if (move && cells[move.index]) {
        const cell = board.children[move.index];
        cell.style.animation = "fadeOut 0.5s forwards";  // Aplica anima√ß√£o de fade-out
        cells[move.index] = null;  // Remove a jogada
        removeIndex++;
      }
    }

    /* Fun√ß√£o que faz o bot jogar */
    function botMove() {
      if (gameOver || currentPlayer !== 'O') return;

      const move = minimaxAI();  // Calcula a melhor jogada do bot
      if (move !== null) {
        playTurn(move, 'O');  // O bot faz a jogada
      }
    }

    /* Fun√ß√£o minimax para o bot decidir sua jogada */
    function minimaxAI() {
      function minimax(boardState, depth, isMaximizing) {
        const winner = checkWinner(boardState);
        if (winner === 'O') return { score: 10 - depth };
        if (winner === 'X') return { score: depth - 10 };
        if (boardState.every(cell => cell !== null)) return { score: 0 };

        const moves = [];

        for (let i = 0; i < boardState.length; i++) {
          if (boardState[i] === null) {
            boardState[i] = isMaximizing ? 'O' : 'X';
            const result = minimax(boardState, depth + 1, !isMaximizing);
            moves.push({ index: i, score: result.score });
            boardState[i] = null;
          }
        }

        const bestScore = isMaximizing
          ? Math.max(...moves.map(m => m.score))
          : Math.min(...moves.map(m => m.score));

        const bestMoves = moves.filter(m => m.score === bestScore);

        return bestMoves[Math.floor(Math.random() * bestMoves.length)];
      }

      function checkWinner(board) {
        for (const pattern of winPatterns) {
          const [a, b, c] = pattern;
          if (board[a] && board[a] === board[b] && board[b] === board[c]) {
            return board[a];
          }
        }
        return null;
      }

      const bestMove = minimax([...cells], 0, true);
      return bestMove.index;
    }

    /* Fun√ß√£o para verificar se um jogador venceu */
    function checkWin(player) {
      return winPatterns.some(pattern =>
        pattern.every(index => cells[index] === player)
      );
    }

    /* Fun√ß√£o para exibir a anima√ß√£o de vit√≥ria */
    function showVictoryAnimation() {
      victoryMessage.style.display = 'block';  // Exibe a mensagem de vit√≥ria
      restartButton.style.display = 'block';  // Exibe o bot√£o de reiniciar
      setTimeout(() => {
        victoryMessage.style.opacity = 1;  // Anima a opacidade
      }, 200);
    }

    /* Fun√ß√£o para reiniciar o jogo */
    function resetGame() {
      cells = Array(9).fill(null);  // Reinicia o estado das c√©lulas
      currentPlayer = 'X';  // Reinicia o jogador
      gameOver = false;  // Reinicia o status do jogo
      moveHistory = [];  // Limpa o hist√≥rico de jogadas
      inRemovalMode = false;  // Desativa o modo de remo√ß√£o
      removeIndex = 0;  // Zera o √≠ndice de remo√ß√£o
      renderBoard();  // Renderiza o tabuleiro
      victoryMessage.style.display = 'none';  // Esconde a mensagem de vit√≥ria
      restartButton.style.display = 'none';  // Esconde o bot√£o de reiniciar
      status.textContent = `Sua vez (${playerName})`;  // Reinicia o status
    }
  </script>
</body>

</html>
